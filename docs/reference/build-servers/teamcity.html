<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <title>GitVersion - TeamCity</title>
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/override.css" rel="stylesheet">
        <script src="/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>        
        <script src="/assets/js/app.min.js"></script>         
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/assets/js/mermaid.min.js"></script>
        <script src="/assets/js/svg-pan-zoom.min.js"></script>

        <meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta name="google-site-verification" content="46g_yrsDyk5YTGoXb2ii9BjmTJ2QAEsacqn6wqiAiII">
<meta property="og:image" content="https://github.com/GitTools/graphics/raw/master/GitVersion/banner-1280x640.png">
<meta property="og:site_name" content="GitVersion">
<meta property="og:type" content="object">
<meta property="og:title" content="GitVersion">
<meta property="og:url" content="https://gitversion.net/">
<meta property="og:description" content="From git log to SemVer in no time">
<link rel="icon" href="/assets/img/icon.png" type="image/png">
<link rel="icon" href="/assets/img/icon.svg" type="image/svg">
<link rel="apple-touch-icon" href="/assets/img/icon.png" type="image/png">
<link rel="apple-touch-icon" href="/assets/img/icon.svg" type="image/svg">

    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/" class="logo">
                            <span>GitVersion</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/docs">Documentation</a></li>
        <li><a href="/api">API</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
        <div><p><a href="https://github.com/gittools/GitVersion/tree/main/docs/input/docs/reference/build-servers/teamcity.md"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit Content</a></p></div>
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#basic-usage">Basic Usage</a></p>
<p><a href="#gitversion-meta-runner-for-teamcity">GitVersion meta runner for TeamCity</a></p>
<p><a href="#running-inside-teamcity">Running inside TeamCity</a></p>
<p><a href="#guides">Guides</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/docs/usage">Usage</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/usage/ci">Continuous Integration</a></li>
                <li class="treeview">
                    <a href="/docs/usage/cli">Command Line</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/usage/cli/installation">Installation</a></li>
                <li><a href="/docs/usage/cli/arguments">Arguments</a></li>
                <li><a href="/docs/usage/cli/output">Output</a></li>
                <li><a href="/docs/usage/cli/assembly-patch">Assembly Patching</a></li>

                    </ul>
                </li>
                <li><a href="/docs/usage/msbuild">MSBuild Task</a></li>
                <li><a href="/docs/usage/library">Library</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/docs/reference">Reference</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/reference/configuration">Configuration</a></li>
                <li><a href="/docs/reference/variables">Version Variables</a></li>
                <li><a href="/docs/reference/requirements">Requirements</a></li>
                <li><a href="/docs/reference/version-increments">Version Incrementing</a></li>
                <li><a href="/docs/reference/version-sources">Version Sources</a></li>
                <li class="treeview">
                    <a href="/docs/reference/modes">Versioning Modes</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/reference/modes/continuous-delivery">Continuous Delivery</a></li>
                <li><a href="/docs/reference/modes/continuous-deployment">Continuous Deployment</a></li>
                <li><a href="/docs/reference/modes/mainline">Mainline Development</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/docs/reference/build-servers">Build Servers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/reference/build-servers/appveyor">AppVeyor</a></li>
                <li><a href="/docs/reference/build-servers/azure-devops">Azure DevOps</a></li>
                <li><a href="/docs/reference/build-servers/bamboo">Bamboo</a></li>
                <li><a href="/docs/reference/build-servers/bitbucket-pipelines">BitBucket Pipelines</a></li>
                <li><a href="/docs/reference/build-servers/buildkite">Buildkite</a></li>
                <li><a href="/docs/reference/build-servers/continua">Continua CI</a></li>
                <li><a href="/docs/reference/build-servers/gitlab">GitLab CI</a></li>
                <li><a href="/docs/reference/build-servers/jenkins">Jenkins</a></li>
                <li><a href="/docs/reference/build-servers/myget">MyGet</a></li>
                <li><a href="/docs/reference/build-servers/octopus-deploy">Octopus Deploy</a></li>
                <li class="selected"><a href="/docs/reference/build-servers/teamcity">TeamCity</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/learn">Learn</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/learn/how-it-works">How it works</a></li>
                <li><a href="/docs/learn/intro-to-semver">Intro to SemVer</a></li>
                <li><a href="/docs/learn/dynamic-repositories">Dynamic Repositories</a></li>
                <li><a href="/docs/learn/git-setup">Git Setup</a></li>
                <li><a href="/docs/learn/faq">FAQ</a></li>
                <li><a href="/docs/learn/why">Why use GitVersion?</a></li>
                <li><a href="/docs/learn/who">Who is using GitVersion</a></li>
                <li><a href="/docs/learn/credits">Credits</a></li>
                <li class="treeview">
                    <a href="/docs/learn/branching-strategies">Branching Strategies</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/learn/branching-strategies/overview">Overview</a></li>
                <li class="treeview">
                    <a href="/docs/learn/branching-strategies/gitflow">Git Flow</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/learn/branching-strategies/gitflow/examples">GitFlow Examples</a></li>
                <li><a href="/docs/learn/branching-strategies/gitflow/converting-to-gitflow">Converting to GitFlow</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/learn/branching-strategies/githubflow">GitHub Flow</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/learn/branching-strategies/githubflow/examples">GitHubFlow Examples</a></li>

                    </ul>
                </li>
                <li><a href="/docs/learn/branching-strategies/contribute-examples">Contribute Examples</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>TeamCity</h1>
		</section>
	<section class="content">
		<h2 id="basic-usage">Basic Usage</h2>
<p>In <a href="https://www.jetbrains.com/teamcity/">TeamCity</a> you can create a build step as follows:</p>
<ul>
<li><strong>Runner type:</strong> Command Line</li>
<li><strong>Run:</strong> Executable with parameters</li>
<li><strong>Command executable:</strong>  <code>GitVersion.exe</code></li>
<li><strong>Command parameters:</strong> <code>/output buildserver /updateassemblyinfo true</code></li>
</ul>
<p>Then in your build parameters simply <a href="#nuget-in-teamcity">add a placeholder</a> of
the GitVersion variables you would like to use.</p>
<p>GitVersion writes system parameters into TeamCity, so they will automatically be
passed to your build scripts to use.</p>
<h2 id="gitversion-meta-runner-for-teamcity">GitVersion meta runner for TeamCity</h2>
<p>TeamCity has support for meta-runners which allow custom tasks. There is a
<a href="https://github.com/JetBrains/meta-runner-power-pack/tree/master/gitversion">GitVersion meta-runner</a> available which makes it easy to use
GitVersion.</p>
<h2 id="running-inside-teamcity">Running inside TeamCity</h2>
<p>When running in TeamCity you have two options, run using <strong>agent checkout</strong> or
use dynamic repositories.</p>
<h3 id="agent-checkout">Agent checkout</h3>
<p>For GitVersion to pick up pull requests properly you need to promote the
<code>%teamcity.build.vcs.branch.{vcsid}%</code> variable to an environment
variable called <code>Git_Branch</code></p>
<p>Just go to your build configuration, Parameters, click Add, Name should be
<code>env.Git_Branch</code>, value should be <code>%teamcity.build.vcs.branch.{vcsid}%</code> where
<code>{vcsid}</code> is your VCS root id. You should get auto completion for this.</p>
<p>For GitVersion to work with any mode requiring other than the currently built
branch to calculate the version number, you need to set the configuration
parameter <a href="https://www.jetbrains.com/help/teamcity/git.html#Git-GeneralSettings"><code>teamcity.git.fetchAllHeads = true</code> in TeamCity</a>,
because TeamCity by default fetches only the current branch for building.</p>
<p>To add this configuration parameter to your build configuration, go to
<em>Parameters</em>, click <em>Add</em>, <em>Name</em> should be <code>teamcity.git.fetchAllHeads</code> and the
value should be <code>true</code>.</p>
<h3 id="dynamic-repositories">Dynamic repositories</h3>
<p>To use server side checkout, you must use the dynamic repositories feature of
GitVersion. Server side checkout sends just the files to the agent and not the
actual .git folder. Dynamic repositories will clone your repo into a temp folder
and use it to calculate version information.</p>
<p>See <a href="/docs/learn/dynamic-repositories">dynamic repositories</a> for more info.</p>
<h3 id="output">Output</h3>
<ul>
<li>We update the TC build number to the GitVersion number automatically</li>
<li>We output the individual values of the GitVersion version variables as build
parameters with format <code>GitVersion.*</code> (Eg: <code>GitVersion.Major</code>) if you need
access to them in your build script. Being system variables they will be passed
as msbuild/environmental variables to other build steps</li>
</ul>
<h3 id="nuget-in-teamcity">NuGet in TeamCity</h3>
<ul>
<li>Add a dummy <a href="http://confluence.jetbrains.com/display/TCD8/Configuring+Build+Parameters">parameter</a> to the project called <code>GitVersion.NuGetVersion</code>. If
many of your projects uses git-flow and SemVer you can add the parameter to
the "root-project" (TeamCity 8.x+). You need a dummy param because
GitVersion creates the variables at runtime, and you cannot reference a
parameter which is not available statically. GitVersion will overwrite the
dummy value.</li>
<li>Then setup you nuget pack build set the "version" to
<code>%GitVersion.NuGetVersion%</code>.</li>
<li>If you do your pack in a build script then you can just use environmental
variables because teamcity will pass them through automatically.</li>
</ul>
<h3 id="when-teamcity-github-cant-use-https">When TeamCity -&gt; GitHub can't use https</h3>
<p>GitVersion requires the presence of main branch in order to determine the
version number.  If TeamCity uses https to clone git repos then GitVersion will
pull down main branch for you during the build.</p>
<p>If however your TeamCity uses SSH to clone git repos and https is unavailable
then GitVersion will error with a message like</p>
<pre><code class="language-cs">[GitVersionTask.UpdateAssemblyInfo] Error occurred: GitVersion.MissingBranchException:
Could not fetch from 'git@github.dev.xero.com:Xero/Bus.git' since LibGit2 does
not support the transport. You have most likely cloned using SSH. If there is a
remote branch named 'main' then fetch it manually, otherwise please create a
local branch named 'main'. ---&gt; LibGit2Sharp.LibGit2SharpException: An error
was raised by libgit2. Category = Net (Error). This transport isn't implemented.
Sorry
</code></pre>
<h2 id="guides">Guides</h2>
<ul>
<li><a href="http://jake.ginnivan.net/blog/2014/07/09/my-typical-teamcity-build-setup">Continuous Delivery Setup in TeamCity</a></li>
</ul>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam2.github.io">Wyam2</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        <div class="github-button">
    <a href="https://github.com/GitTools/GitVersion"><i class="fa fa-github"></i> GitHub</a>
</div>
<script>
    ((window.gitter = {}).chat = {}).options = {
        room: 'GitTools/GitVersion'
    };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script>

        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>