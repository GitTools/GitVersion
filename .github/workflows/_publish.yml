on:
  workflow_call:

env:
  DOTNET_INSTALL_DIR: "./.dotnet"
  DOTNET_ROLL_FORWARD: "Major"

jobs:
  publish:
    name: ${{ matrix.taskName }}
    runs-on: windows-2025
    strategy:
      fail-fast: false
      matrix:
        taskName: [ NuGet, Chocolatey ]

    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      CHOCOLATEY_API_KEY: ${{ secrets.CHOCOLATEY_API_KEY }}
    steps:
    -
      name: Checkout
      uses: actions/checkout@v5
      with:
        fetch-depth: 0
    -
      name: Restore State
      uses: ./.github/actions/cache-restore
    -
      uses: actions/download-artifact@v6
      name: Download nuget packages
      with:
        name: nuget
        path: ${{ github.workspace }}/artifacts/packages/nuget

    -
      name: NuGet login (OIDC â†’ temp API key)
      uses: NuGet/login@v1
      id: login
      with:
        user: 'gittoolsbot'
    -
      name: '[Publish]'
      shell: pwsh
      env:
        NUGET_API_KEY: ${{ steps.login.outputs.NUGET_API_KEY }}
      run: dotnet run/publish.dll --target=Publish${{ matrix.taskName }}
