name: Code Format
on:
  push:
    branches:
    - main
    - 'fix/*'
    - 'feature/*'
    - 'poc/*'
    - 'support/*'
    paths:
    - '**'
    - '!docs/**'
    - '!.github/**'
    - .github/workflows/format.yml

  pull_request:
    branches:
    - main
    - 'support/*'
    paths:
    - '**'
    - '!docs/**'
    - '!.github/**'
    - .github/workflows/format.yml

permissions:
  contents: read

env:
  DOTNET_ROLL_FORWARD: "Major"
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
  DOTNET_NOLOGO: 1

jobs:
  format:
    runs-on: ubuntu-latest
    name: DotNet Format
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: audit

      -
        name: Checkout
        uses: actions/checkout@v4
      -
        name: Setup .NET SDK
        uses: actions/setup-dotnet@v4
        with:
          global-json-file: global.json
      -
        name: Run Format 'ci' solution
        run: dotnet format ./build/ --verify-no-changes
      -
        name: Build 'new-cli' solution
        run: dotnet build ./new-cli
      -
        name: Run Format 'new-cli' solution
        run: dotnet format ./new-cli/ --exclude ~/.nuget/packages --verify-no-changes
      -
        name: Run Format 'GitVersion' solution
        run: dotnet format ./src/ --exclude **/AddFormats/ --verify-no-changes
